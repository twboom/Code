<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynthQuencer | App</title>
    <script>
      let synthquencer=[];synthquencer.config={startNote:60,notes:16,steps:16,speed:100,tuning:440,transposition:0},synthquencer.state={active:!1},synthquencer.targets={root:synthquencer.config},synthquencer.synths=[],synthquencer.tiles=[],synthquencer.utility=[],synthquencer.utility.getTarget=function(t){let e;for(const[n,s]of Object.entries(synthquencer.targets)){Object.keys(s).includes(t)&&(e=s)}return e},synthquencer.utility.getFrequency=function(t){const e=t-68+12*synthquencer.config.transposition;return synthquencer.config.tuning*2**(e/12)},synthquencer.utility.getBPM=function(t,e){return 6e4/(t/e/4)/1e3},synthquencer.tile=class{constructor(t,e,n){this.wave=t,this.note=e,this.step=n,this.activated=!1,this.id=`${synthquencer.synths.length}-${this.wave}-${this.step}-${this.note}`}changeState(t,e){t.activated?(t.activated=!1,e.setAttribute("data-activated","false"),console.log(`Deactivated ${this.wave}, ${this.note}, ${this.step}`)):(t.activated=!0,e.setAttribute("data-activated","true"),console.log(`Activated ${this.wave}, ${this.note}, ${this.step}`))}create(t){const e=this.id,n=document.createElement("button");return n.setAttribute("class","tile"),n.setAttribute("draggable",!1),n.setAttribute("data-wave",this.wave),n.setAttribute("data-note",this.note),n.setAttribute("data-step",this.step),n.setAttribute("data-activated",!1),n.setAttribute("data-isPlaying",!1),n.setAttribute("id",e),n.addEventListener("mousedown",t=>{this.changeState(this,n)}),n.addEventListener("mouseover",synthquencer.drag.move),t.appendChild(n),synthquencer.tiles.push(this),this}},synthquencer.synth=class{constructor(t,e,n){this.wave=t,this.notes=e,this.steps=n,this.id=synthquencer.synths.length,this.tiles=[]}create(){const t=this.wave,e=this.notes,n=this.steps;for(let s=0;s<n;s++){const n=document.createElement("div");n.setAttribute("class","step");for(let r=0;r<e;r++){const e=synthquencer.config.startNote+r,c=new synthquencer.tile(t,e,s);c.create(n),this.tiles.push(c)}document.querySelector(`div#synth-${this.id}`).appendChild(n)}}},synthquencer.frame=[],synthquencer.frame.create=function(t){const e=document.createElement("div");e.setAttribute("id",`synth-${synthquencer.synths.length}`),e.setAttribute("class","synth"),e.addEventListener("mousedown",synthquencer.drag.start),e.addEventListener("mouseup",synthquencer.drag.stop),document.querySelector("div#sequencer").appendChild(e);const n=new synthquencer.synth(t,16,16);n.create(),synthquencer.synths.push(n)},synthquencer.frame.remove=function(){document.querySelectorAll("div.synth").forEach(t=>{t.remove()})},synthquencer.sound=function(t,e){const n=synthquencer.interface,s=n.createOscillator();s.type=e,s.frequency.value=synthquencer.utility.getFrequency(t);const r=n.createGain();r.gain.exponentialRampToValueAtTime(1e-5,n.currentTime+1),s.connect(r),r.connect(n.destination),s.start(0),s.stop(n.currentTime+.5),synthquencer.stats.stats.played++},synthquencer.playRow=function(t,e){const n=document.querySelectorAll(`div#synth-${t} button.tile[data-step="${e}"][data-activated=true]`);if(0===n.length)return;const s=n[0].getAttribute("data-wave");for(let t=0;t<n.length;t++){const e=n[t].getAttribute("data-note");synthquencer.sound(e,s)}},synthquencer.tick=function(t,e){lastStep=e-1,0===e&&(lastStep=15),synthquencer.playRow(t,e);{const t=document.querySelectorAll(`button.tile[data-step="${e}"]`);for(let e=0;e<t.length;e++)t[e].setAttribute("data-isplaying",!0)}{const t=document.querySelectorAll(`button.tile[data-step="${lastStep}"]`);for(let e=0;e<t.length;e++)t[e].setAttribute("data-isplaying",!1)}},synthquencer.deactivate=function(){clearInterval(synthquencer.clock),document.querySelectorAll("button.tile[data-isplaying=true]").forEach(t=>{t.setAttribute("data-isplaying",!1)}),synthquencer.state.active=!1},synthquencer.toggle=function(){let t=0;synthquencer.state.active?synthquencer.deactivate():(synthquencer.state.active=!0,synthquencer.clock=setInterval(e=>{for(let e=0;e<synthquencer.synths.length;e++)synthquencer.tick(e,t);16==(t+=1)&&(t=0)},synthquencer.config.speed))},synthquencer.stats=[],synthquencer.stats.stats={played:0},synthquencer.prompt=[],synthquencer.prompt.verify=function(t){const e=document.createElement("div"),n=document.createElement("div"),s=document.createElement("h1"),r=document.createElement("p"),c=document.createElement("button"),i=document.createElement("button");s.innerHTML=t.title,r.innerHTML=t.body,c.innerHTML="Deny",i.innerHTML="Accept",e.setAttribute("class","prompt"),e.setAttribute("id","prompt-outer"),n.setAttribute("class","prompt"),n.setAttribute("id","body"),s.setAttribute("class","prompt"),r.setAttribute("class","prompt"),c.setAttribute("class","prompt deny"),i.setAttribute("class","prompt accept"),c.addEventListener("click",synthquencer.prompt.close),i.addEventListener("click",synthquencer.prompt.close),n.appendChild(s),n.appendChild(r),n.appendChild(c),n.appendChild(i),e.appendChild(n),document.body.appendChild(e)},synthquencer.prompt.close=function(t){let e=t.target.classList[1];const n=document.querySelector("div.prompt#prompt-outer");switch(e){case"deny":e=!1;break;case"accept":e=!0}return n.remove(),console.log(e),e},synthquencer.prompt.new=function(t,e){let n;if(void 0===e)throw new Error("Undefined mode");return"verify"===e&&(n=synthquencer.prompt.verify(t)),console.log(n),n};
    </script>
    <style media="screen">
      @import url(https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap);@import url(https://fonts.googleapis.com/css2?family=Open+Sans&display=swap);:root{--size:24px;--background:#22222e;--panel-background:#323242;--panel-shadow:drop-shadow(0 0 10px #121212);--isPlaying:#4b4b4b;--handle-color:#8c24ed;--sine-color:#431761;--sine-active:#9c1cf1;--square-color:#501c1c;--square-active:#e00404;--saw-color:#18226e;--saw-active:#283cd4;--triangle-color:#106e14;--triangle-active:#1eeb25}body{background-color:var(--background)}h1.header{font-family:'Bebas Neue';color:#fff;text-align:center;font-size:64px;letter-spacing:8px}div#main{display:flex;width:80%;margin-left:10%;justify-content:center}div#main>div{margin:16px}div#sequencer{padding:4px;background-color:var(--panel-background);border:hidden;border-radius:8px;filter:var(--panel-shadow)}button.tile{all:unset;width:var(--size);height:var(--size);outline:none;border:solid;border-width:2px;border-radius:8px;margin:4px;cursor:pointer;transition:0.1s}button.tile[data-wave=sine]{border-color:var(--sine-active)}button.tile[data-wave=sine][data-activated=false]{background-color:var(--sine-color)}button.tile[data-wave=sine][data-activated=true]{background-color:var(--sine-active)}button.tile[data-wave=square]{border-color:var(--square-active)}button.tile[data-wave=square][data-activated=false]{background-color:var(--square-color)}button.tile[data-wave=square][data-activated=true]{background-color:var(--square-active)}button.tile[data-wave=sawtooth]{border-color:var(--saw-active)}button.tile[data-wave=sawtooth][data-activated=false]{background-color:var(--saw-color)}button.tile[data-wave=sawtooth][data-activated=true]{background-color:var(--saw-active)}button.tile[data-wave=triangle]{border-color:var(--triangle-active)}button.tile[data-wave=triangle][data-activated=false]{background-color:var(--triangle-color)}button.tile[data-wave=triangle][data-activated=true]{background-color:var(--triangle-active)}button.tile[data-isplaying=true][data-activated=false]{background-color:var(--isPlaying)}button.tile[data-isplaying=true][data-activated=true]{background-color:#fff}div#prompt-outer{position:fixed;z-index:1;width:100%;height:100%;top:0;left:0;background-color:#000;background-color:#00000080;backdrop-filter:blur(5px)}div#body{width:70%;margin:15% auto;background-color:var(--panel-background);text-align:center;padding:16px;border:hidden;border-radius:16px;filter:drop-shadow(0 0 10px #1e1e25)}h1.prompt{margin-top:0;margin-bottom:0;font-family:'Bebas Neue';letter-spacing:2px;color:#fff}p.prompt{margin-top:0}button.prompt{font-family:'Bebas Neue';letter-spacing:2px;font-size:24px;padding:8px;min-width:10%;margin:16px;outline:none;border:hidden;border-radius:4px;color:#fff;cursor:pointer;transition:0.25s}button.prompt.accept{background-color:#4CAF50}button.prompt.deny{background-color:#f44336}button.prompt.accept:hover{background-color:#458b47}button.prompt.deny:hover{background-color:#b43228}button.prompt.accept:active,button.prompt.deny:active{background-color:#fff;color:#000}header{text-align:center}h1.header{margin:0}p.header{font-family:'Bebas Neue';color:#fff;font-size:32px}main{color:#fff;font-family:'Open Sans';display:block;width:70%;margin-left:15%}a{color:#fff}div#controls{height:fit-content}div.control-panel{background-color:var(--panel-background);padding:16px;border:hidden;border-radius:8px;filter:var(--panel-shadow);min-width:20%;text-align:center}button.controls{outline:none;margin-bottom:4px}p{color:#fff;font-family:'Open Sans';margin:0}button.controls{appearance:none;-webkit-appearance:none;background-color:var(--handle-color);font-family:'Open Sans';border:hidden;border-radius:8px;width:50%;color:#fff;padding:8px;margin:16px;font-size:16px;cursor:pointer;transition:0.5s}button.controls:hover{background-color:var(--isPlaying);width:80%}button.controls:active{background-color:#fff;color:#000}input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:8px;background:#fff;border:hidden;border-radius:8px;outline:none;opacity:.5;transition:0.5s;cursor:pointer}input[type=range]:hover{opacity:1}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:15px;height:15px;border-radius:50%;background-color:var(--handle-color);cursor:w-resize}input[type=range]::-moz-range-thumb{width:15px;height:15px;border-radius:50%;background-color:var(--handle-color);outline:none;cursor:w-resize}
    </style>
</head>
<body>
    <header>
        <h1 class="header">SynthQuencer</h1>
    </header>
    <main>
        <div id="main">
            <!--All the controls-->
            <div id="controls">
                <div id="direct-controls" class="control-panel">
                    <div>
                        <button id="toggle" class="controls">Start</button>
                    </div>
                    <div>
                        <p>Speed: <span class="speed display"></span> ms</p>
                        <input class="control" type="range" name="speed" id="speed" min="0" max="1000" step="1" style="direction: rtl;">
                    </div>
                    <div>
                        <p>Tuning: <span class="tuning display"></span>Hz</p>
                        <input class="control" type="range" name="tuning" id="tuning" min="432" max="440">
                    </div>
                    <div>
                        <p>Transpose: <span class="transposition display"></span> octaves</p>
                        <input class="control" type="range" name="transposition" id="transposition" min="-4" max="4" step="1">
                    </div>
                    <div>
                        <button id="reset-grid" class="controls">Reset</button>
                    </div>
                </div>
                <!--Buttons for opening modals-->
                <div id="modals">

                </div>
            </div>
            <!--All the grids-->
            <div id="sequencer"></div>
        </div>
        <!--Modals-->
    </main>
    <!--Scripts that require page to be loaded-->
    <script type="text/javascript">
      synthquencer.interface=[],synthquencer.interface.update=function(e){const t=e.target,n=document.querySelector(`span.${t.id}.display`);synthquencer.utility.getTarget(t.id)[t.id]=parseInt(t.value),null!==n&&(n.innerHTML=t.value)},synthquencer.interface.init=function(){document.querySelectorAll("span.display").forEach(e=>{const t=e.classList[0],n=document.querySelector("span."+t),r=document.querySelector("input#"+t),s=synthquencer.utility.getTarget(t)[t];n.innerHTML=s,r.value=s})},document.querySelectorAll("input.control").forEach(e=>{e.addEventListener("input",synthquencer.interface.update)}),document.querySelector("button#toggle.controls").addEventListener("click",e=>{synthquencer.interface=new AudioContext;const t=document.querySelector("button#toggle.controls");synthquencer.state.active?t.innerHTML="Start":t.innerHTML="Stop",synthquencer.toggle()}),document.querySelector("button#reset-grid").addEventListener("click",e=>{state=!0,state?(synthquencer.frame.remove(),synthquencer.frame.create(session.wave),console.log("Grid was cleared")):console.log("Grid was not cleared")}),synthquencer.drag=[],synthquencer.drag.state=!1,synthquencer.drag.move=function(e){if(!synthquencer.drag.state)return;const t=e.target,n=synthquencer.tiles.find(({id:e})=>e===t.id);n.changeState(n,t)},synthquencer.drag.start=function(e){synthquencer.drag.state=!0},synthquencer.drag.stop=function(e){synthquencer.drag.state=!1};const sq=synthquencer;let session=[];session.wave=new URL(document.location).searchParams.get("wave"),null===session.wave&&(session.wave="sine"),sq.frame.create(session.wave),sq.interface.init();
    </script>
</body>
</html>
